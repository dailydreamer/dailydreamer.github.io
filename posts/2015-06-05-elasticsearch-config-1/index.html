<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="dailydreamer的小空间">


<link rel="shortcut icon" href="/images/avatar.jpg" />

<meta name="keywords" content="ElasticSearch, 搜索">
<title>ElasticSearch搜索配置（1）</title>

<link href="/index.xml" rel="alternate" type="application/rss+xml" title="dailydreamer" />
<link href="/index.xml" rel="feed" type="application/rss+xml" title="dailydreamer" />

<link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.5.0/css/bulma.min.css" rel="stylesheet" type="text/css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="/css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75912368-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <nav class="nav has-shadow">
  <div class="nav-left">
    <span id="toggle__menu" class="nav-toggle">
      <span></span>
      <span></span>
      <span></span>
    </span>
    <a href="/index.html" class="nav-item">Dailydreamer's Space</a>
  </div>

  <div class="nav-center">
    <a class="nav-item" href="https://github.com/dailydreamer">
      <span class="icon">
        <i class="fa fa-github"></i>
      </span>
    </a>
    <a class="nav-item" href="https://www.linkedin.com/in/dailydreamer/">
      <span class="icon">
        <i class="fa fa-linkedin-square" aria-hidden="true"></i>        
      </span>
    </a>
    <a class="nav-item" href="/index.xml" type="application/rss+xml">
      <span class="icon">
        <i class="fa fa-rss"></i>
      </span>
    </a>
  </div>
</nav>      

  <div id="container">
    <aside>
  <nav class="sidebar">
    <div id="tags__ul">
      <a id="all_posts" class="tag is-rounded is-primary">
        全部 
        <span class="tag-count">36</span>
      </a>
      
      <a id="编程" class="tag is-rounded">
        编程 
        <span class="tag-count">17</span>
      </a>
      
      <a id="读书笔记" class="tag is-rounded">
        读书笔记 
        <span class="tag-count">17</span>
      </a>
      
      <a id="项目" class="tag is-rounded">
        项目 
        <span class="tag-count">6</span>
      </a>
      
      <a id="web" class="tag is-rounded">
        web 
        <span class="tag-count">5</span>
      </a>
      
      <a id="产品经理" class="tag is-rounded">
        产品经理 
        <span class="tag-count">5</span>
      </a>
      
      <a id="心理学" class="tag is-rounded">
        心理学 
        <span class="tag-count">4</span>
      </a>
      
      <a id="编程语言" class="tag is-rounded">
        编程语言 
        <span class="tag-count">4</span>
      </a>
      
      <a id="哲学" class="tag is-rounded">
        哲学 
        <span class="tag-count">3</span>
      </a>
      
      <a id="科学" class="tag is-rounded">
        科学 
        <span class="tag-count">3</span>
      </a>
      
      <a id="maker" class="tag is-rounded">
        maker 
        <span class="tag-count">1</span>
      </a>
      
      <a id="ssh" class="tag is-rounded">
        ssh 
        <span class="tag-count">1</span>
      </a>
      
      <a id="创业" class="tag is-rounded">
        创业 
        <span class="tag-count">1</span>
      </a>
      
      <a id="理财" class="tag is-rounded">
        理财 
        <span class="tag-count">1</span>
      </a>
      
      <a id="系统安全" class="tag is-rounded">
        系统安全 
        <span class="tag-count">1</span>
      </a>
      
      <a id="自动驾驶" class="tag is-rounded">
        自动驾驶 
        <span class="tag-count">1</span>
      </a>
      
      <a id="行业" class="tag is-rounded">
        行业 
        <span class="tag-count">1</span>
      </a>
      
      <a id="设计" class="tag is-rounded">
        设计 
        <span class="tag-count">1</span>
      </a>
      
    </div>

    <div class="menu">
      <ul id="posts__ul" class="menu-list">
        
        
        
        
        <li class="all_posts 读书笔记">
          <a href="https://dailydreamer.me/posts/2021-10-24-the-minds-i/">
            <span class="posts-title">探秘意识 - 读《我是谁或什么》</span>
            <span class="posts-date">Oct, 2021</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/posts/2018-11-25-python-concurrency/">
            <span class="posts-title">Python 并发模型</span>
            <span class="posts-date">Nov, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记">
          <a href="https://dailydreamer.me/posts/2018-11-20-lessons-of-history/">
            <span class="posts-title">历史的教训</span>
            <span class="posts-date">Nov, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 心理学">
          <a href="https://dailydreamer.me/posts/2018-07-13-poor-charlie/">
            <span class="posts-title">穷查理宝典</span>
            <span class="posts-date">Jul, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 心理学">
          <a href="https://dailydreamer.me/posts/2018-06-13-principles/">
            <span class="posts-title">原则</span>
            <span class="posts-date">Jun, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 项目 产品经理 行业">
          <a href="https://dailydreamer.me/posts/2018-06-13-apparel-sales-prediction/">
            <span class="posts-title">智慧服装</span>
            <span class="posts-date">Jun, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 项目 maker">
          <a href="https://dailydreamer.me/posts/2018-06-03-xlchain/">
            <span class="posts-title">XLChain</span>
            <span class="posts-date">Jun, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 项目 编程 自动驾驶">
          <a href="https://dailydreamer.me/posts/2018-01-28-foodgo-autonomous-food-delivery/">
            <span class="posts-title">FoodGo, 层级式的配送小车</span>
            <span class="posts-date">Jan, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 产品经理 项目 创业">
          <a href="https://dailydreamer.me/posts/2018-01-09-past-failed-experiences/">
            <span class="posts-title">过去失败的创业尝试</span>
            <span class="posts-date">Jan, 2018</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 项目 产品经理">
          <a href="https://dailydreamer.me/posts/2017-12-05-nutriment/">
            <span class="posts-title">Nutriment</span>
            <span class="posts-date">Dec, 2017</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 科学 哲学">
          <a href="https://dailydreamer.me/posts/2017-08-26-the-grand-design/">
            <span class="posts-title">大设计</span>
            <span class="posts-date">Aug, 2017</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 科学">
          <a href="https://dailydreamer.me/posts/2017-08-07-a-new-kind-of-science-2/">
            <span class="posts-title">一种新科学(2)</span>
            <span class="posts-date">Aug, 2017</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 项目 心理学">
          <a href="https://dailydreamer.me/posts/2017-05-21-gamification/">
            <span class="posts-title">游戏化 Gamification</span>
            <span class="posts-date">May, 2017</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 产品经理">
          <a href="https://dailydreamer.me/posts/2016-06-16-mobile-application-experience/">
            <span class="posts-title">移动端体验</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 理财">
          <a href="https://dailydreamer.me/posts/2016-06-15-fund-tips/">
            <span class="posts-title">买基金给我加薪</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/posts/2016-06-09-inspired-by-functional-programing-language/">
            <span class="posts-title">从函数式语言想到的</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/posts/2016-05-25-webrtc-introduction/">
            <span class="posts-title">WebRTC简介</span>
            <span class="posts-date">May, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 设计">
          <a href="https://dailydreamer.me/posts/2016-05-24-some-design-books/">
            <span class="posts-title">读过的一些设计书籍</span>
            <span class="posts-date">May, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/posts/2016-04-25-dom-and-dom-event/">
            <span class="posts-title">DOM和DOM Event</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/posts/2016-04-14-css-cheat-sheet/">
            <span class="posts-title">CSS Cheat Sheet</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/posts/2016-04-09-spa-jwt-auth/">
            <span class="posts-title">单页应用JWT身份认证</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/posts/2016-04-08-cors-solve-same-origin-policy-problem/">
            <span class="posts-title">CORS解决单页应用跨域问题</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 科学">
          <a href="https://dailydreamer.me/posts/2016-03-20-a-new-kind-of-science/">
            <span class="posts-title">一种新科学</span>
            <span class="posts-date">Mar, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 心理学">
          <a href="https://dailydreamer.me/posts/2016-03-07-difficult-conversation/">
            <span class="posts-title">关键对话</span>
            <span class="posts-date">Mar, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 哲学">
          <a href="https://dailydreamer.me/posts/2016-01-13-power-of-myth/">
            <span class="posts-title">神话的力量</span>
            <span class="posts-date">Jan, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 系统安全">
          <a href="https://dailydreamer.me/posts/2015-11-23-meet-ctf/">
            <span class="posts-title">一次与CTF的邂逅</span>
            <span class="posts-date">Nov, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 ssh">
          <a href="https://dailydreamer.me/posts/2015-10-30-ssh-config/">
            <span class="posts-title">多个github账号的ssh key切换</span>
            <span class="posts-date">Oct, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 哲学">
          <a href="https://dailydreamer.me/posts/2015-08-04-zen-and-the-art-of-motorcycle-maintenance/">
            <span class="posts-title">禅与摩托车维修的艺术</span>
            <span class="posts-date">Aug, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 产品经理">
          <a href="https://dailydreamer.me/posts/2015-07-25-product-manager/">
            <span class="posts-title">人人都是产品经理</span>
            <span class="posts-date">Jul, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/posts/2015-06-29-hiding-mouse-globally-in-wpf/">
            <span class="posts-title">WPF全局隐藏鼠标</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 编程">
          <a href="https://dailydreamer.me/posts/2015-06-28-unix-programming-art/">
            <span class="posts-title">UNIX编程艺术</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/posts/2015-06-23-python-yeild-and-parse-xml/">
            <span class="posts-title">Python解析XML与生成迭代器</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程">
          <a href="https://dailydreamer.me/posts/2015-06-22-elasticsearch-config-2/">
            <span class="posts-title">ElasticSearch搜索配置（2）</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程">
          <a href="https://dailydreamer.me/posts/2015-06-05-elasticsearch-config-1/">
            <span class="posts-title">ElasticSearch搜索配置（1）</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 编程">
          <a href="https://dailydreamer.me/posts/2015-06-04-a-pragmatic-programmer/">
            <span class="posts-title">程序员修炼之道</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程">
          <a href="https://dailydreamer.me/posts/2015-06-02-config-elasticsearch-on-aws/">
            <span class="posts-title">在AWS上配置ElasticSearch</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
      </ul>
    </div>
  </nav>
</aside>
    <article>
      <div class="content post">
        <h1 data-identifier="2015-06-05">
          ElasticSearch搜索配置（1）
          <span class="posts-date">Jun, 2015</span> 
        </h1>       
        <div class="tags">
          
          <span class="tag is-medium" style="margin-left:0">编程</span>
          
        </div>
        <p>最近在用ElasticSearch做一些搜索，来谈谈其中用到的一些特性。</p>
<p>ElasticSearch是基于Lucene的分布式包装，其中每一个分片或一个副本都是一个Lucene实例。
ElasticSearch实现了很好的扩展性和冗余，自动负载均衡。可以通过Restful API与ElasticSearch集群交互。
我使用的是<a href="https://elasticsearch-py.readthedocs.org/en/master/">python API</a>。</p>
<p>可以参考<a href="https://www.elastic.co/guide/en/elasticsearch/guide/master/index.html">ElasticSearch权威指南</a>，讲解非常清楚。</p>
<h2 id="建立索引">建立索引</h2>
<p>建立索引的时候可以使用mapping建立对每个字段建立映射。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mapping_body <span style="color:#f92672">=</span> {
	<span style="color:#e6db74">&#39;mappings&#39;</span>:{
		<span style="color:#e6db74">&#39;tweet&#39;</span>:{
			<span style="color:#e6db74">&#34;properties&#34;</span>:{
				<span style="color:#e6db74">&#39;text&#39;</span>:{<span style="color:#e6db74">&#39;type&#39;</span>:<span style="color:#e6db74">&#39;string&#39;</span>, <span style="color:#e6db74">&#39;index&#39;</span>:<span style="color:#e6db74">&#39;analyzed&#39;</span>, <span style="color:#e6db74">&#39;analyzer&#39;</span>:<span style="color:#e6db74">&#39;ik_smart&#39;</span>, <span style="color:#e6db74">&#39;similarity&#39;</span>: <span style="color:#e6db74">&#39;BM25&#39;</span>}
			}
		}
	}
}
es<span style="color:#f92672">.</span>indices<span style="color:#f92672">.</span>create(index<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;test-index&#39;</span>, body<span style="color:#f92672">=</span>mapping_body)
</code></pre></div><p>上面为&rsquo;test-index&rsquo;的索引中&rsquo;tweet&rsquo;的type中&rsquo;text&rsquo;字段建立映射。</p>
<p>&lsquo;index&rsquo;设置为analyzed说明要先通过分析器，&lsquo;analyzer&rsquo;设置分析器为ik分词的智能粒度切分，默认为standard，不适合中文分词;&lsquo;similarity&rsquo;设置了相似度算法为BM25，默认为向量空间算法。</p>
<p>具体可以看<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html">文档</a>。</p>
<h2 id="查询">查询</h2>
<p>查询可以通过ID来检索，但是作为一个搜索引擎，ElasticSearch提供了一种基于JSON的<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">DSL查询格式</a>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">search_body <span style="color:#f92672">=</span> {
	<span style="color:#e6db74">&#34;query&#34;</span>: {
        <span style="color:#e6db74">&#34;multi_match&#34;</span>: {
            <span style="color:#e6db74">&#34;query&#34;</span>:       <span style="color:#e6db74">&#34;Hello世界&#34;</span>,
            <span style="color:#e6db74">&#34;type&#34;</span>:        <span style="color:#e6db74">&#34;cross_fields&#34;</span>, 
            <span style="color:#e6db74">&#34;operator&#34;</span>:    <span style="color:#e6db74">&#34;or&#34;</span>,
            <span style="color:#e6db74">&#34;fields&#34;</span>:      [ <span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#e6db74">&#34;text^2&#34;</span> ]
        }
	 },
	<span style="color:#e6db74">&#39;highlight&#39;</span>:{
		<span style="color:#e6db74">&#39;fields&#39;</span>:{
			<span style="color:#e6db74">&#39;author&#39;</span>:{},
			<span style="color:#e6db74">&#39;text&#39;</span>:{}
		}
	}

}
res <span style="color:#f92672">=</span> es<span style="color:#f92672">.</span>search(index<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;test-index&#39;</span>, doc_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tweet&#39;</span>, body<span style="color:#f92672">=</span>search_body)
</code></pre></div><h3 id="query">Query</h3>
<p>上面的示例中使用了<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html">multi match query</a>来进行多字段查询，multi match query对fields中的每个field进行query查询。</p>
<p>&lsquo;operator&rsquo;定义了对查询结果进行的操作，&lsquo;or&rsquo;代表取并集。</p>
<p>fields中的<code>^</code>代表对该字段进行boost，之后的值为浮点数，小于1表示减轻权重，否则加大权重。</p>
<p>&lsquo;type&rsquo;中的类型和适用场景见下表</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Explain</th>
</tr>
</thead>
<tbody>
<tr>
<td>best_fields</td>
<td>(default) Finds documents which match any field, but uses the <code>_score</code> from the best field. See best_fields.</td>
</tr>
<tr>
<td>most_fields</td>
<td>Finds documents which match any field and combines the <code>_score</code> from each field. See most_fields.</td>
</tr>
<tr>
<td>cross_fields</td>
<td>Treats fields with the same analyzer as though they were one big field. Looks for each word in any field. See cross_fields.</td>
</tr>
<tr>
<td>phrase</td>
<td>Runs a match_phrase query on each field and combines the <code>_score</code> from each field. See phrase and phrase_prefix.</td>
</tr>
<tr>
<td>phrase_prefix</td>
<td>Runs a match_phrase_prefix query on each field and combines the <code>_score</code> from each field. See phrase and phrase_prefix.</td>
</tr>
</tbody>
</table>
<p><code>cross_fields</code>是将所有字段放在一起搜索，跟对<code>_all</code>进行query相比它可以附加权重，但是效率略微低一点。</p>
<p>更加详细的type的使用情景可以看权威指南的<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_single_query_string.html">Know Your Data</a>一节。</p>
<h3 id="function-score-query和script">Function Score query和script</h3>
<p>如果需要吧离线算好的pagerank和在线查询的得分结合起来给结果排序，可以使用强大的<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html">Function Score query</a>和<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#_indexed_scripts">script</a>来做到这一点。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#e6db74">&#34;query&#34;</span>:{
	<span style="color:#e6db74">&#34;function_score&#34;</span>: {
	    <span style="color:#e6db74">&#34;boost_mode&#34;</span>: <span style="color:#e6db74">&#34;replace&#34;</span>,
		<span style="color:#e6db74">&#34;query&#34;</span>: {
	        <span style="color:#e6db74">&#34;multi_match&#34;</span>: {
	            <span style="color:#e6db74">&#34;query&#34;</span>:query,
	            <span style="color:#e6db74">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;cross_fields&#34;</span>, 
	            <span style="color:#e6db74">&#34;operator&#34;</span>:<span style="color:#e6db74">&#34;or&#34;</span>,
	            <span style="color:#e6db74">&#34;fields&#34;</span>:SEACHFIELDS
	        }
		 },
	    <span style="color:#e6db74">&#34;script_score&#34;</span>: {
			<span style="color:#e6db74">&#34;lang&#34;</span>:<span style="color:#e6db74">&#34;groovy&#34;</span>,
	        <span style="color:#e6db74">&#34;params&#34;</span>: {
	        	<span style="color:#e6db74">&#34;pagerankField&#34;</span>: PAGERANK, 
	            <span style="color:#e6db74">&#34;pagerankW&#34;</span>: PAGERANKW, 
	            <span style="color:#e6db74">&#34;scoreW&#34;</span>: <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> PAGERANKW
	        },
	        <span style="color:#e6db74">&#34;script_file&#34;</span>: <span style="color:#e6db74">&#34;school-search&#34;</span>
	    }
	}
}
</code></pre></div><p>使用<code>function_score</code>将原query包裹起来，在<code>script_score</code>中，<code>lang</code>设置脚本语言，默认为groovy;<code>params</code>设置脚本参数，<code>script_file</code>指定脚本文件，脚本文件保存在<code>./config/scripts/</code>下，不用写出后缀名，<code>config/scripts/group1/group2/test.py</code>应该命名为<code>group1_group2_test</code>。</p>
<p>脚本内容类似下面</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">_score <span style="color:#f92672">*</span> scoreW <span style="color:#f92672">+</span> doc<span style="color:#f92672">[</span>pagerankField<span style="color:#f92672">].</span><span style="color:#a6e22e">value</span> <span style="color:#f92672">*</span> pagerankW
</code></pre></div><p>其中<code>_score</code>是query得分，<code>doc[field_name]</code>可以获得当前doc的field，也可在其中使用<code>parms</code>中指定的参数。</p>
<p>还有一种使用脚本的方法是将其索引在一个特殊文件<code>.scripts</code>中，但是由于这个功能曾经爆出漏洞，而且性能不如上面的方法，现在已经默认关闭，在此不再讨论。</p>
<h3 id="highlight">Highlight</h3>
<p>使用highlight可以在返回结果的&rsquo;highlight&rsquo;字段中对匹配词进行高亮，&lsquo;fields&rsquo;设置要高亮的field，还可以对高亮格式进行设置，默认为<!-- raw HTML omitted --><!-- raw HTML omitted -->。详细可以看<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-highlighting.html#_highlight_query">这里</a>。</p>
<h3 id="filter">Filter</h3>
<p>filter更像是数据库中的一些操作，不会返回_score值，只有满足条件才会被返回，但是相比query效率更高。详细可以看<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-filters.html">这里</a>。</p>
<p>有了这些基本能够满足简单的搜索需要了。</p>
<p>找到了一个翻译了一部分权威指南的Blog，记录在<a href="http://blog.csdn.net/dm_vincent/article/details/41820537">这里</a>。</p>

        
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dailydreamer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>      
    </article>
  </div>

  <script src="/js/zepto.min.js"></script>
<script src="/js/script.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/yaml.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>  
</body>
</html>
